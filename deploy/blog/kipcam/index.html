<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-45464992-2"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-45464992-2');
    </script>

    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css?v=21e4d4b2e1" />
    <link rel="stylesheet" type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css" />

    <title>Kipcam</title>

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="canonical" href="http://fransruben.io/blog/kipcam/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="http://fransruben.io/blog/kipcam/amp/" />
    
    <meta property="og:site_name" content="Personal Website" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Kipcam" />
    <meta property="og:description" content="As the new year stood before us, so did, although more literally, the untouched garden of our new house. It was 40 Square meters of 5 different types of stone tiles, randomly arranged to prevent the weeds from overtaking the backyard. To improve upon this dreadful sight, we spend the" />
    <meta property="og:url" content="http://fransruben.io/blog/kipcam/" />
    <meta property="og:image" content="http://fransruben.io/content/images/2019/12/IMG_3372_small.jpg" />
    <meta property="article:published_time" content="2019-12-23T13:09:12.000Z" />
    <meta property="article:modified_time" content="2020-01-03T20:01:27.000Z" />
    <meta property="article:tag" content="article" />
    
    <meta property="article:publisher" content="https://www.facebook.com/ghost" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Kipcam" />
    <meta name="twitter:description" content="As the new year stood before us, so did, although more literally, the untouched garden of our new house. It was 40 Square meters of 5 different types of stone tiles, randomly arranged to prevent the weeds from overtaking the backyard. To improve upon this dreadful sight, we spend the" />
    <meta name="twitter:url" content="http://fransruben.io/blog/kipcam/" />
    <meta name="twitter:image" content="http://fransruben.io/content/images/2019/12/IMG_3372_small.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Ruben van den Hout" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="article" />
    <meta name="twitter:site" content="@tryghost" />
    <meta property="og:image:width" content="907" />
    <meta property="og:image:height" content="1210" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Personal Website",
        "logo": {
            "@type": "ImageObject",
            "url": "http://fransruben.io/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "Ruben van den Hout",
        "url": "http://fransruben.io/author/ruben/",
        "sameAs": []
    },
    "headline": "Kipcam",
    "url": "http://fransruben.io/blog/kipcam/",
    "datePublished": "2019-12-23T13:09:12.000Z",
    "dateModified": "2020-01-03T20:01:27.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "http://fransruben.io/content/images/2019/12/IMG_3372_small.jpg",
        "width": 907,
        "height": 1210
    },
    "keywords": "article",
    "description": "As the new year stood before us, so did, although more literally, the untouched\ngarden of our new house. It was 40 Square meters of 5 different types of stone\ntiles, randomly arranged to prevent the weeds from overtaking the backyard. To\nimprove upon this dreadful sight, we spend the next two months digging, building\nand planting the garden so we could enjoy it in spring. The main feature was the\nchicken-run that would be the new home for two chickens.\n\nHaving saved two chickens from a premature",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://fransruben.io/"
    }
}
    </script>

    <meta name="generator" content="Ghost 3.2" />
    <link rel="alternate" type="application/rss+xml" title="Personal Website" href="http://fransruben.io/rss/" />

</head>

<body class="post-template tag-article">
    <div class="gh-viewport">

        <header id="gh-head" class="gh-head">
            <nav class="gh-head-inner gh-container">

                <div class="gh-head-brand">
                    <h1>Ruben</h1>
                    <a class="gh-burger" role="button">
                        <div class="gh-burger-box">
                            <div class="gh-burger-inner"></div>
                        </div>
                    </a>
                </div>

                <div class="gh-head-menu">
                    <ul class="nav" role="menu">
    <li class="nav-work" role="menuitem"><a href="http://fransruben.io/">Work</a></li>
    <li class="nav-about" role="menuitem"><a href="http://fransruben.io/about/">About</a></li>
</ul>

                </div>

                <div class="gh-socials-container">
                    <div class="gh-socials">
                        <a href="https://www.linkedin.com/in/rubenvandenhout" target="_blank" style="font-size:18px">
                            <span class="fab fa-linkedin-in"></span>
                        </a>
                         <a href="https://www.instagram.com/fransruben" target="_blank" style="font-size:18px">
                            <span class="fab fa-instagram"></span>
                        </a>
                    </div>
                </div>
            </nav>
        </header>

        <main class="gh-main">

            

<article class="gh-article post tag-article">

    <header class="gh-header gh-canvas">
        <h1 class="gh-title">Kipcam</h1>
    </header>

    <div class="gh-content gh-canvas">
        <figure class="kg-card kg-gallery-card kg-width-wide"><div class="kg-gallery-container"><div class="kg-gallery-row"><div class="kg-gallery-image"><img src="http://fransruben.io/content/images/2020/01/img-chicken3.jpg" width="1001" height="1000"></div><div class="kg-gallery-image"><img src="http://fransruben.io/content/images/2020/01/img-chicken1.jpg" width="1200" height="900"></div></div></div></figure><p>As the new year stood before us, so did, although more literally, the untouched garden of our new house. It was 40 Square meters of 5 different types of stone tiles, randomly arranged to prevent the weeds from overtaking the backyard. To improve upon this dreadful sight, we spend the next two months digging, building and planting the garden so we could enjoy it in spring. The main feature was the chicken-run that would be the new home for two chickens.</p><p>Having saved two chickens from a premature end-of-life, we gave them names that would symbolically free them from their anonymous life: <strong>Kipchoge</strong> and <strong>Kipchumba</strong>.</p><h2 id="kipcam">Kipcam </h2><p>Chickens are curious creatures. They like to digg, eat everything that looks edible and lay eggs like there is no tomorrow. All these eggs need to be collected, but from the outside you never know if there are any eggs in the nest. To save me from the occasional disappointment, I installed a camera in the henhouse: the kipcam!</p><p>I quickly moved past any privacy concerns regarding the chickens and started planning the setup. I choose for a Wanscam HW0021 with WiFi and a dual-axis rotating camera to adjust the view. It does not have power over ethernet, so the only cable to connect was a power cable. </p><figure class="kg-card kg-image-card"><img src="http://fransruben.io/content/images/2020/01/sketch-topview-3.png" class="kg-image"></figure><figure class="kg-card kg-image-card kg-card-hascaption"><img src="http://fransruben.io/content/images/2020/01/detect-baseimg-1.jpg" class="kg-image"><figcaption>Snapshot of the Kipcam</figcaption></figure><h2 id="egg-detection">Egg detection</h2><p>Great! We can make snapshots and and view the nest by logging in to the IP camera from my local network. But what if we could automatically detect how many eggs lay in the nest? Enter phase two.</p><p>With object detection it all comes down to what differentiates that object from its surroundings. Looking at an egg in a nest, there are many ways to go about detection: color, surface area, edges, eliptical shape and even size. </p><figure class="kg-card kg-image-card"><img src="http://fransruben.io/content/images/2020/01/egg_properties.png" class="kg-image"></figure><p>Before writing an algorithm myself, I looked for people who tried to solve the same problem and found the startup Eggs Iting. They have developed <a href="https://en.eggs-iting.com/blog/prototype/detecting-eggs-in-the-nest.html">a clever way</a> to detect eggs using Local Binary Patterns. It is a fairly complex approach, but results in a robust detection. First I wanted to try a simpler solution because of two reasons:</p><!--kg-card-begin: markdown--><ul>
<li>First of all, they use a flash when taking snapshots to have a consistent light intensity and distribution on the photos they do detection on. This is especially useful when using LBP, but not possible with my setup.</li>
<li>Second, to know whether there is an egg, you need to compare an LBP histogram with that of a reference and calculate the minimum acceptable difference. That means needing a lot of labeled egg images..</li>
</ul>
<p>Therefore, I look at how well I could detect eggs without using reference images</p>
<!--kg-card-end: markdown--><h3 id="hough-transform">Hough Transform</h3><p>The first idea was to use the hard edge, eliptical shape and consistent size to detect the eggs with a circular hough transform. This requires input parameters on the expected radius of the circle and is executed on binary image from canny edge detection. After playing with the parameters, the accumulator of the hough transform was too messy to clearly identify the center of each egg, altough there are some weak bright spots at the center of each egg, it gets lost in the noise. Â </p><figure class="kg-card kg-image-card kg-width-wide"><img src="http://fransruben.io/content/images/2020/01/detect-hough-collage-1.png" class="kg-image"></figure><h3 id="distance-transform">Distance transform</h3><p>Looking at the canny edge detection output, I thought well from here it is pretty clear where the eggs lie. Mainly because of the matte surface, there are no edges detected inside the eggs. So instead of trying to the rid of the background, I can use high frequency noise to detect the eggs.</p><p>A distance transform calculates the distance to the nearest white pixel (edge pixel). This simple calculation clearly shows three islands with the highest value in the center as this is farthest from the edge in a circle. Using some constraints on the size and shape of the islands, it was easy to label them and detect eggs fairly accurately.</p><figure class="kg-card kg-image-card kg-width-wide"><img src="http://fransruben.io/content/images/2020/01/detect-distancetf-collage.png" class="kg-image"></figure><h2 id="telegram-bot">Telegram bot</h2><p>The beauty of looking through the camera and detecting eggs was still confined to my local network and a Python script I had to run manually. To make this more user-friendly and available outside the comfort of my home, I wrote a telegram bot. </p><!--kg-card-begin: markdown--><p>Telegram offers a very accesible API to create bots and there was even a Python wrapper available to make common tasks easier. The bot runs on a Raspberry Pi Model 3B+ that is connected to my local network and IP camera, to prevent port forwarding of the camera directly. The bot has two commands that fire the corresponding python scripts:</p>
<ul>
<li><em>/snap</em> : take a snapshot with the camera</li>
<li><em>/detect</em> : detect how many eggs lay in the nest</li>
</ul>
<!--kg-card-end: markdown--><figure class="kg-card kg-image-card kg-width-wide"><img src="http://fransruben.io/content/images/2020/01/telegram-bot-1.png" class="kg-image"></figure><h2 id="conclusion">Conclusion</h2><p>It was great fun to make the hardware and software work together and show friends the magic of realtime egg detection on my phone. The detection is not as robust as I would like, but I'm still very pleased with the performance for such a simple algorithm. I am happy, let's see if the chickens will also thrive in their new home.</p><figure class="kg-card kg-image-card"><img src="http://fransruben.io/content/images/2020/01/img-chicken2.jpg" class="kg-image"></figure><p></p><p></p><p></p><p></p>
    </div>

    <footer class="gh-footer gh-canvas">
    </footer>

</article>



        </main>

    </div>


    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>


    <script>
        $(document).ready(function () {
            // Mobile Menu Trigger
            $('.gh-burger').click(function () {
                $('body').toggleClass('gh-head-open');
            });
        });
    </script>

    <script src="/assets/built/jquery.fitvids.js?v=21e4d4b2e1"></script>
    <script>
        var images = document.querySelectorAll('.kg-gallery-image img');
        images.forEach(function (image) {
            var container = image.closest('.kg-gallery-image');
            var width = image.attributes.width.value;
            var height = image.attributes.height.value;
            var ratio = width / height;
            container.style.flex = ratio + ' 1 0%';
        });
        $(document).ready(function () {
            var $postContent = $(".gh-content");
            $postContent.fitVids();
        });
    </script>

    

    <script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
    <script src="/assets/js/masonry.js?v=21e4d4b2e1"></script>

</body>

</html>